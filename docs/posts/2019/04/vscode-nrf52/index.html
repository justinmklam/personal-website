<!DOCTYPE html>
<html lang="en">

<head>
    <title>Nordic nRF52 Development with Visual Studio Code</title>
    <meta property="og:image" content="http://justinmklam.com/imgs/2020/vscode-nrf52/vs-code-debug.png"/>
    <meta property="og:type" content="blog"/>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-85178257-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-85178257-1');
</script>


<script>
    var shiftWindow = function() { scrollBy(0, -70) };
    window.addEventListener("hashchange", shiftWindow);
    function load() { if (window.location.hash) shiftWindow(); }
</script>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content=

    "One editor to rule them all, one editor to find them."

>
<meta name="author" content="Justin Lam">


<link rel="stylesheet" href="/css/bootstrap-modified.min.css">
<link rel="stylesheet" href="/css/jmklam-portfolio.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i|Roboto+Slab|DM+Sans:500&display=swap">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/atom-one-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>


<link rel="stylesheet" href="/css/bootstrap-toc.css">


</head>

<body onload="load()" data-spy="scroll" data-target="#toc">

    <!DOCTYPE html>
<html lang="en">


<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        
        <div class="navbar-header">
            <button id="hamburger-menu" type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <a class="navbar-brand" href="http://justinmklam.com">Justin Lam</a>

        </div>
        
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">

				
					<li><a href="/">Blog</a></li>
				
					<li><a href="/archives/">Archives</a></li>
				
					<li><a href="/about/">About</a></li>
				
					<li><a href="/contact/">Contact</a></li>
				

            </ul>
        </div>
        
    </div>
    
</nav>

</html>


    
    <div class="container" id="page-container">

        
        <div class="row">
                <div class="col-sm-2">
                    </div>
            <div class="col-sm-8" id="blog">
                <br>
                <h2 data-toc-skip class="blog-title">Nordic nRF52 Development with Visual Studio Code</h2>
                
                <p class="datestamp-index"><span class="fa fa-calendar-o"></span>&nbsp Posted on April 25, 2019
<em>&nbsp &middot &nbsp&nbsp5 min read
    &nbsp &middot &nbsp
    <span class="disqus-comment-count" data-disqus-url="http://justinmklam.com/posts/2019/04/vscode-nrf52/#disqus_thread"># comments</span>
    &nbsp &middot &nbsp
    
    <a class="blog-tag" href="/tags/programming">#programming&nbsp</a>
    
    <a class="blog-tag" href="/tags/embedded">#embedded&nbsp</a>
    
</em>
</p>

                
                <a href=/imgs/2020/vscode-nrf52/vs-code-debug.png>
                    <img class="img-responsive img-span-row blog-header-img" src="/imgs/2020/vscode-nrf52/vs-code-debug.png">
                </a>

                <div class="blog-content page-content">
                    <p>A few years ago, I created a <a href="https://www.justinmklam.com/posts/2017/10/vscode-debugger-setup/">tutorial</a> on setting up Visual Studio Code for development with the STM32. Since I&rsquo;ve also been developing on the Nordic nRF52, I thought I&rsquo;d share another tutorial to show how a project can be set up, flashed, and debugged using Visual Studio Code.</p>
<p>The template project discussed in this post can be found on <a href="https://github.com/justinmklam/nrf52-blinky-demo">Github</a>.</p>
<h1 id="instructions">Instructions</h1>
<p>The Nordic toolchain is cross-platform, but the instructions below are specifically for Linux. However, they can easily be replicated in Windows as long as installation paths and environment variables are set correctly.</p>
<h2 id="general-comments">General Comments</h2>
<p>When using any editor + terminal for nRF52 development, the things to remember are:</p>
<ul>
<li>GCC path is set in <code>&lt;sdk&gt;/components/toolchain/gcc/Makefile.posix</code></li>
<li>Makefile is up to date with:
<ul>
<li><code>SDK_ROOT</code> is pointed to where <code>&lt;sdk&gt;</code> is located</li>
<li>Source and header files for new components</li>
<li>Board/component configurations in <code>sdk_config.h</code></li>
</ul>
</li>
</ul>
<p>With Visual Studio Code:</p>
<ul>
<li>In <code>.vscode/c_cpp_properties.json</code>, update <code>defines</code>, <code>includePath</code>, and <code>compilerPath</code> as required</li>
<li>In <code>.vscode/launch.json</code>, update <code>executable</code> and <code>armToolchainPath</code> as required</li>
<li>In <code>.vscode/tasks.json</code>, update the current working directory <code>cwd</code> and <code>command</code> as required (ie. changing to <code>make flash -j8</code> to use 8 cores to build).</li>
</ul>
<h2 id="installation">Installation</h2>
<h3 id="system-tools">System Tools</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install build-essential

<span style="color:#008000"># Required by java-based CMSIS Configuration Wizard</span>
sudo apt install default-jre
</code></pre></div><h3 id="code-editor">Code Editor</h3>
<ul>
<li><a href="https://code.visualstudio.com/download">Visual Studio Code</a>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools">C/C++ Extension</a> by Microsoft</li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=marus25.cortex-debug">Cortex-Debug Extension</a> by marus25</li>
</ul>
</li>
</ul>
<h3 id="nrf52-toolchain">nRF52 Toolchain</h3>
<h4 id="download">Download</h4>
<ol>
<li><a href="https://www.nordicsemi.com/Software-and-Tools/Software/nRF5-SDK">nRF52 SDK</a></li>
<li><a href="https://www.nordicsemi.com/Software-and-Tools/Development-Tools/nRF5-Command-Line-Tools">nRF52 Command Line Tools</a></li>
<li><a href="https://www.segger.com/downloads/jlink">Segger J-Link Software Tools</a></li>
<li><a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads">GNU-RM Embedded Toolchain for ARM</a>
<ul>
<li>It&rsquo;s recommended to install the GCC version that matches the Nordic SDK version. Check the GCC version in <code>&lt;sdk&gt;/components/toolchain/gcc/Makefile.posix</code> and download the appropriate version.</li>
<li>For nRF5 SDK 15.3.0, the gcc version is <code>gcc-arm-none-eabi-7-2018-q2-update</code></li>
</ul>
</li>
</ol>
<p>Optional:</p>
<ol>
<li><a href="https://www.segger.com/downloads/jlink/#Ozone">Segger Ozone Debugger</a></li>
</ol>
<h4 id="setup">Setup</h4>
<p>Run the commands below to extract the archives to the respective paths.</p>
<ul>
<li>nRF5_SDK to <code>$HOME</code></li>
<li>nRF Command Line Tools to <code>/opt/</code> and <code>/usr/local/bin</code></li>
<li>gcc-arm-none-eabi to <code>/usr/local/bin</code></li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#008000"># Unpack SDK to home directory</span>
unzip nRF5_SDK_15.3.0_59ac345.zip -d $HOME

<span style="color:#008000"># Unpack nRF command line tools and make accessible in terminal</span>
tar -xvf nRF-Command-Line-Tools_9_8_1_Linux-x86_64.tar --directory /opt/
sudo ln -s /opt/nrfjprog/nrfjprog /usr/local/bin/nrfjprog

<span style="color:#008000"># Install Segger</span>
sudo apt install ./JLink_Linux_V644f_x86_64.deb

<span style="color:#008000"># Unpack gcc toolchain to /usr/local/bin</span>
sudo tar -xjvf gcc-arm-none-eabi-8-2018-q4-major-linux.tar.bz2 --directory /usr/local/bin
</code></pre></div><p>If optional tools are downloaded:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#008000"># Segger Ozone</span>
sudo apt install ./Ozone_Linux_V262_x86_64.deb
</code></pre></div><p>Check <code>nrfjproj --version</code> that it&rsquo;s been installed correctly.</p>
<h3 id="nordic-sdk-setup">Nordic SDK Setup</h3>
<p>In the nRF52 SDK folder, update the values in <code>components/toolchain/gcc/Makefile.posix</code>:</p>
<ul>
<li><code>GNU_INSTALL_ROOT</code></li>
<li><code>GNU_VERSION</code></li>
</ul>
<p>This is only required if using a different gcc version than specified. It&rsquo;s recommended to use the same one as the SDK.</p>
<h2 id="using-the-project">Using the Project</h2>
<h3 id="setup-1">Setup</h3>
<p>In <code>blinky/</code> directory, do a global search and replace to update the SDK root to wherever your nRF5_SDK directory is:</p>
<ul>
<li>From: <code>SDK_ROOT := ../../../../../..</code></li>
<li>To: <code>SDK_ROOT := $(HOME)/nRF5_SDK_15.3.0_59ac345</code></li>
</ul>
<p>If required, update the following in <code>.vscode/c_cpp_properties.json</code>:</p>
<ul>
<li>Include paths</li>
<li>Defines based on C/assembler flags in the Makefile</li>
</ul>
<h3 id="configuring-sdk_configh">Configuring <code>sdk_config.h</code></h3>
<p><a href="https://sourceforge.net/projects/cmsisconfig/">CMSIS Configuration Wizard</a> is integrated with example makefiles. In order to open sdk_config.h in this tool, type:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">make sdk_config
</code></pre></div><h3 id="build-and-flash">Build and Flash</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd blinky/pca10056/mbr/armgcc

<span style="color:#008000"># To just build. Optional `-jN` flag, where N is number of cores to use</span>
make

<span style="color:#008000"># To build and flash</span>
make flash

<span style="color:#008000"># If a SoftDevice is included in your project</span>
make flash_softdevice
</code></pre></div><p>Build tasks can also be added to <code>.vscode/tasks.json</code>. Pressing <code>CTRL+SHIFT+B</code> will execute the default build task (in this case, the default build task is <code>make flash</code> for <code>PCA10056</code>).</p>
<h3 id="segger-rtt-log">Segger RTT Log</h3>
<p>To use the RTT Viewer equivalent on GNU/Linux, start by opening a terminal and starting <code>JLinkExe</code>.</p>
<p>Follow the steps below to connect the device (in this case, <code>NRF52840_XXAA</code>). Press ENTER to accept the default value. The only option that needs to be changed (aside from board, if necessary) is the target interface (use <code>SWD</code> instead of <code>JTAG</code>).</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">J-Link&gt;connect
Device&gt;
Please specify target interface:
  J) JTAG (Default)
  S) SWD
  T) cJTAG
TIF&gt;S
Specify target interface speed [kHz]. &lt;Default&gt;: 4000 kHz
Speed&gt;
Device <span style="color:#a31515">&#34;NRF52840_XXAA&#34;</span> selected.
</code></pre></div><p>Alternatively, you can specify the configurations in the command line:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">JLinkExe -device NRF52832_XXAA -if SWD -speed 4000 -autoconnect 1
</code></pre></div><p>In another terminal, start <code>JLinkRTTClient</code>. RTT output should now start displaying. Output should be as follows:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#008000">###RTT Client: ************************************************************</span>
<span style="color:#008000">###RTT Client: *               SEGGER Microcontroller GmbH                *</span>
<span style="color:#008000">###RTT Client: *   Solutions for real time microcontroller applications   *</span>
<span style="color:#008000">###RTT Client: ************************************************************</span>
<span style="color:#008000">###RTT Client: *                                                          *</span>
<span style="color:#008000">###RTT Client: *       (c) 2012 - 2016  SEGGER Microcontroller GmbH       *</span>
<span style="color:#008000">###RTT Client: *                                                          *</span>
<span style="color:#008000">###RTT Client: *     www.segger.com     Support: support@segger.com       *</span>
<span style="color:#008000">###RTT Client: *                                                          *</span>
<span style="color:#008000">###RTT Client: ************************************************************</span>
<span style="color:#008000">###RTT Client: *                                                          *</span>
<span style="color:#008000">###RTT Client: * SEGGER J-Link RTT Client   Compiled Apr 12 2019 17:30:19 *</span>
<span style="color:#008000">###RTT Client: *                                                          *</span>
<span style="color:#008000">###RTT Client: ************************************************************</span>

<span style="color:#008000">###RTT Client: -----------------------------------------------</span>
<span style="color:#008000">###RTT Client: Connecting to J-Link RTT Server via localhost:19021  Connected.</span>
SEGGER J-Link V6.44f - Real time terminal output
J-Link OB-SAM3U128-V2-NordicSemi compiled Jan  7 2019 14:07:15 V1.0, SN=683903307
Process: JLinkExe
&lt;info&gt; app: SPI example started.
&lt;info&gt; app: Transfer completed.
&lt;info&gt; app: Transfer completed.
&lt;info&gt; app: Transfer completed.
...
</code></pre></div><h3 id="debugging">Debugging</h3>
<h4 id="visual-studio-code">Visual Studio Code</h4>
<ol>
<li>Open the debug pane (<code>CTRL+SHIFT+D</code>) and select <strong>Cortex-Debug</strong>.</li>
<li>To create a new configuration, select <strong>Add Configuration</strong> and choose <strong>Cortex-Debug</strong>.</li>
<li>If required, update the <code>executable</code> and/or <code>armToolchainPath</code> in <code>.vscode/launch.json</code>.</li>
<li>Hit <code>F5</code> to start debugging.</li>
</ol>
<h4 id="segger-o-zone">Segger O-zone</h4>
<p>Using Segger Ozone provides rich insights on memory, assembly instructions, peripheral registers, etc.</p>
<div class="row captioned-img">
    <a href=/imgs/2020/vscode-nrf52/segger-ozone.png><img class="img-responsive img-content" src=/imgs/2020/vscode-nrf52/segger-ozone.png /></a>
    <p class="caption">Screencap of using Segger Ozone debugger.</p>
</div>

<p>New project settings:</p>
<ol>
<li>Select <strong>Create new project</strong></li>
<li>Choose target device
<ul>
<li>Select device: <code>nRF52840_xxAA</code> (or other)</li>
<li>Peripherals: (blank)</li>
</ul>
</li>
<li>Connection settings
<ul>
<li>Target interface: SWD</li>
<li>Target interface speed: 1 MHz</li>
<li>Host interface: USB</li>
<li>Serial no: (blank)</li>
</ul>
</li>
<li>Program file
<ul>
<li>Select <code>pca10056/mbr/armgcc/_build/nrf52840_xxaa.out</code></li>
</ul>
</li>
</ol>
<h1 id="resources">Resources</h1>
<ul>
<li><a href="https://infocenter.nordicsemi.com/index.jsp">Nordic Information Center</a> - Official Documentation</li>
</ul>
<p>Happy developing!</p>

                </div>

                
                <br>
                <div class="text-left">
                    <a class="blog-nav-btn" href="/">
                        <span style="font-size:0.83em" class="glyphicon glyphicon-menu-left"></span>Recent Posts
                    </a>
                </div>
                <hr>
                <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'justinmklam';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


            </div>

            <div class="col-sm-1">
                    <nav id="toc" data-toggle="toc" data-spy="affix"></nav>
                </div>
            


        </div>
    </div>
    

        
    <script src="/js/jquery.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>
    
    <script src="/js/bootstrap-toc.min.js"></script>

    
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
    <script src="https://use.fontawesome.com/ccb78cc113.js"></script>

    
    <script id="dsq-count-scr" src="//justinmklam.disqus.com/count.js" async></script>

    
    <script>
        $(document).ready(function(){
            $('#hamburger-menu').click(function(){
                $(this).toggleClass('open');
            });
        });
    </script>


</body>


<footer>
	<div class="col-lg-8 col-centered">
		<hr>
		<p class="text-center">&copy; 2020 Justin MK Lam</p>
	</div>

	
	<div id="amzn-assoc-ad-8dae4bf9-b4e8-4c3d-8d99-cd2028a68840"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=8dae4bf9-b4e8-4c3d-8d99-cd2028a68840"></script>
</footer>

</html>
